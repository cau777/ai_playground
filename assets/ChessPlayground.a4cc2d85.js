import{g as b,t as $,h as G,j as L,i as r,c as a,a as g,f as I,k as T,r as q,I as U,F as z,l as N,d as j,m as D,n as H,p as V,q as Y,v as J}from"./entry-client.75050314.js";import{N as K}from"./NavControls.fe784304.js";import{C as Q}from"./ChessPiece.fd6402b7.js";import{b as R}from"./LanguagesContext.a908c724.js";import{B as A,P as W}from"./BtnPrimary.8abdea67.js";const X=$('<svg viewBox="0 0 100 100" width="100%"><circle cx="50" cy="50" r="15" fill="black"></circle></svg>'),Z=()=>b(X),ee=$('<div class="select-none grid grid-cols-8 grid-rows-8 max-h-[30rem] max-w-[30rem] border-t-2 border-r-2 bg-primary-400"></div>'),te=$('<div class="absolute t-0 l-0 w-full h-full z-10 opacity-20"></div>'),le=$('<div class="relative border-l-2 border-b-2"><!#><!/><div class="p-1"></div></div>');function ne(e){let t=7-Math.floor(e/8),n=e%8;return String.fromCodePoint(65+n)+(t+1)}const F=e=>{let t=()=>{let i=e.board.replaceAll(`
`,"").replaceAll(" ","").split("");if(i.length!=64)throw new RangeError("Malformed literal: invalid size");return i},[n,l]=L();function _(i,d,s){if(!!e.interactive)if(s===void 0){if(i==="_")return;l({notation:d})}else s.notation===d||e.onMove(s.notation,d),l(void 0)}let o=()=>e.reversed?t().reverse():t();return(()=>{const i=b(ee);return r(i,a(U,{get each(){return o()},children:(d,s)=>{let c=()=>e.reversed?63-s:s,m=()=>ne(c()),S=()=>(Math.floor(c()/8)+c()%8)%2==0,p=()=>{let u=n();return u!==void 0&&e.possible.get(u.notation)?.has(m())===!0},x=()=>n()?.notation===m();return(()=>{const u=b(le),h=u.firstChild,[f,C]=g(h.nextSibling),y=f.nextSibling;return u.$$click=()=>_(d(),m(),n()),r(u,a(I,{get when(){return p()},keyed:!1,get children(){const v=b(te);return r(v,a(Z,{})),v}}),f,C),r(y,a(Q,{get notation(){return d()}})),T(v=>{const k=!!S(),w=!!x();return k!==v._v$&&u.classList.toggle("bg-primary-50",v._v$=k),w!==v._v$2&&u.classList.toggle("bg-primary-200",v._v$2=w),v},{_v$:void 0,_v$2:void 0}),q(),u})()}})),i})()};G(["click"]);function B(e){let t=new Map;for(let[n,l]of e)t.has(n)||t.set(n,new Set),t.get(n).add(l);return t}const ie=$('<select class="rounded bg-back-1 px-2 py-1 border-2 border-black outline-0"></select>'),re=$("<option></option>"),se=e=>(()=>{const t=b(ie);return t.addEventListener("change",n=>e.onSelect(n.currentTarget.value)),r(t,a(z,{get each(){return e.options},children:n=>(()=>{const l=b(re);return r(l,()=>n.label),T(()=>l.value=n.value),l})()})),t})(),ae=$("<div></div>"),oe=$('<button class="border-2 rounded px-2 py-1 transition-all duration-100"></button>'),de=e=>(()=>{const t=b(ae);return r(t,a(z,{get each(){return e.options},children:n=>{let l=()=>e.selected==n.value;return(()=>{const _=b(oe);return _.$$click=()=>e.setSelected(n.value),r(_,()=>n.label),T(o=>N(_,{"bg-primary-700 border-primary-800":l(),"border-primary-700":!l()},o)),q(),_})()}})),T(n=>N(t,e.classList,n)),t})();G(["click"]);const _e=$('<section class="flex"><div class="p-4 rounded border-2 bg-back-1 mb-3 border-back-2"><div class="grid grid-cols-2 gap-y-3"><label></label><!#><!/><label></label><!#><!/></div><div class="grid-center mt-5"><!#><!/><!#><!/></div></div></section>'),ce=e=>{let[t,n]=L({side:!0,openings_book:"complete"}),l=R();return(()=>{const _=b(_e),o=_.firstChild,i=o.firstChild,d=i.firstChild,s=d.nextSibling,[c,m]=g(s.nextSibling),S=c.nextSibling,p=S.nextSibling,[x,u]=g(p.nextSibling),h=i.nextSibling,f=h.firstChild,[C,y]=g(f.nextSibling),v=C.nextSibling,[k,w]=g(v.nextSibling);return r(d,()=>l.playAs),r(i,a(de,{get options(){return[{label:l.whiteSide,value:!0},{label:l.randomSide,value:void 0},{label:l.blackSide,value:!1}]},setSelected:M=>n(P=>({...P,side:M})),classList:{"flex gap-3":!0},get selected(){return t().side}}),c,m),r(S,()=>l.openingsBook),r(i,a(se,{get options(){return[{label:l.complete,value:"complete"},{label:l.none,value:"none"},{label:l.gambits,value:"gambits"},{label:l.mainlines,value:"mainlines"},{label:"e4",value:"e4"},{label:"d4",value:"d4"}]},onSelect:M=>n(P=>({...P,openings_book:M}))}),x,u),r(h,a(I,{get when(){return e.loading},keyed:!0,get children(){return a(A,{get label(){return l.loading},onClick:()=>{},disabled:!0,classList:{"text-lg font-semibold":!0}})}}),C,y),r(h,a(I,{get when(){return!e.loading},keyed:!0,get children(){return a(A,{get label(){return l.start},onClick:()=>{e.onClickPlay(t())},classList:{"text-lg font-semibold":!0}})}}),k,w),_})()},ue=$('<div class="leading-tight min-h-[5em]"><!#><!/><p><!#><!/>: <!#><!/></p><p></p></div>'),ge=$("<p><!#><!/>: <!#><!/> </p>"),be=e=>{let t=R(),n=()=>t[e.result??"gameResultUndefined"],l=()=>e.playerTurn?t.playerTurn:t.aiTurn;return(()=>{const _=b(ue),o=_.firstChild,[i,d]=g(o.nextSibling),s=i.nextSibling,c=s.firstChild,[m,S]=g(c.nextSibling),p=m.nextSibling,x=p.nextSibling,[u,h]=g(x.nextSibling),f=s.nextSibling;return r(_,(()=>{const C=j(()=>!!e.opening);return()=>C()&&(()=>{const y=b(ge),v=y.firstChild,[k,w]=g(v.nextSibling),M=k.nextSibling,P=M.nextSibling,[E,O]=g(P.nextSibling);return E.nextSibling,r(y,()=>t.opening,k,w),r(y,()=>e.opening,E,O),y})()})(),i,d),r(s,()=>t.gameResult,m,S),r(s,n,u,h),r(f,l),_})()},$e=$("<div><!#><!/><!#><!/></div>"),me=e=>{let[t,n]=L(!1);async function l(i,d,s){if(t()||s===void 0||!s.possible.get(i)?.has(d))return;n(!0);let c=await V(s.gameId,i,d);e.setState({gameId:s.gameId,possible:B(c.possible),board:c.board,state:c.game_state,opening:c.opening,initialSide:e.initialSide}),n(!1)}let _=()=>e.state==="gameResultUndefined"&&!t(),o;return D(()=>{o?.scrollIntoView()}),(()=>{const i=b($e),d=i.firstChild,[s,c]=g(d.nextSibling),m=s.nextSibling,[S,p]=g(m.nextSibling),x=o;return typeof x=="function"?H(x,i):o=i,r(i,a(F,{get interactive(){return _()},get board(){return e.board},get possible(){return e.possible},onMove:(u,h)=>l(u,h,e),get reversed(){return!e.initialSide}}),s,c),r(i,a(be,{get opening(){return e.opening},get result(){return e.state},get playerTurn(){return!t()}}),S,p),i})()},fe=$('<h1 class="text-3xl font-black text-primary-100 mb-3"></h1>'),ve=$('<div class="flex flex-col"><!#><!/><!#><!/><!#><!/></div>'),he="_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",Ce=()=>{let[e,t]=L(),[n,l]=L(!1),_=R();return a(K,{get children(){return a(W,{get children(){return[(()=>{const o=b(fe);return r(o,()=>_.title),o})(),(()=>{const o=b(ve),i=o.firstChild,[d,s]=g(i.nextSibling),c=d.nextSibling,[m,S]=g(c.nextSibling),p=m.nextSibling,[x,u]=g(p.nextSibling);return r(o,a(ce,{onClickPlay:async h=>{l(!0);try{let f=await Y(h);t({board:f.board,gameId:f.game_id,possible:B(f.possible),state:f.game_state,opening:f.opening,initialSide:f.player_side})}finally{l(!1)}},get loading(){return n()}}),d,s),r(o,a(I,{get when(){return e()===void 0},keyed:!0,get children(){return a(F,{board:he,reversed:!1,onMove:()=>{},get possible(){return B([])},interactive:!1})}}),m,S),r(o,a(I,{get when(){return e()!==void 0},keyed:!0,get children(){return a(me,J(()=>e(),{setState:t}))}}),x,u),o})()]}})}})};export{Ce as C};
