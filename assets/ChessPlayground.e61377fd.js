import{g as m,t as f,h as A,j as w,i as o,c as p,a as b,f as L,k as q,r as z,I as G,d as I,l as U}from"./entry-client.90c743b5.js";import{N as j}from"./NavControls.62cbfbd5.js";import{C as D}from"./ChessPiece.5cccb6bf.js";import{P as H,c as K,a as O}from"./PlaygroundContainer.de320385.js";import{b as k}from"./LanguagesContext.85a57efe.js";const Q=f('<svg viewBox="0 0 100 100" width="100%"><circle cx="50" cy="50" r="15" fill="black"></circle></svg>'),F=()=>m(Q),J=f('<div class="select-none grid grid-cols-8 grid-rows-8 max-h-[30rem] max-w-[30rem] border-t-2 border-r-2 bg-primary-400"></div>'),V=f('<div class="absolute t-0 l-0 w-full h-full z-10 opacity-20"></div>'),W=f('<div class="relative border-l-2 border-b-2 "><!#><!/><div class="p-1"></div></div>');function X(e){let n=7-Math.floor(e/8),r=e%8;return String.fromCodePoint(65+r)+(n+1)}const Y=e=>{let n=()=>{let l=e.board.replaceAll(`
`,"").replaceAll(" ","").split("");if(l.length!=64)throw new RangeError("Malformed literal: invalid size");return l},[r,c]=w();function d(l,i,s){if(!!e.interactive)if(s===void 0){if(l==="_")return;c({notation:i})}else s.notation===i||e.onMove(s.notation,i),c(void 0)}return(()=>{const l=m(J);return o(l,p(G,{get each(){return n()},children:(i,s)=>{let t=X(s),g=(Math.floor(s/8)+s%8)%2==0,_=()=>{let a=r();return a!==void 0&&e.possible.get(a.notation)?.has(t)===!0},u=()=>r()?.notation===t;return(()=>{const a=m(W),x=a.firstChild,[$,S]=b(x.nextSibling),y=$.nextSibling;return a.$$click=()=>d(i(),t,r()),a.classList.toggle("bg-primary-50",g),o(a,p(L,{get when(){return _()},keyed:!1,get children(){const h=m(V);return o(h,p(F,{})),h}}),$,S),o(y,p(D,{get notation(){return i()}})),q(()=>a.classList.toggle("bg-primary-200",!!u())),z(),a})()}})),l})()};A(["click"]);const Z=f('<div class="leading-tight min-h-[5em]"><!#><!/><p><!#><!/>: <!#><!/></p><p></p></div>'),ee=f("<p><!#><!/>: <!#><!/> </p>"),te=e=>{let n=k(),r=()=>n[e.result??"gameResultUndefined"],c=()=>{switch(e.playerTurn){case void 0:return n.loading;case!0:return n.playerTurn;case!1:return n.aiTurn}};return(()=>{const d=m(Z),l=d.firstChild,[i,s]=b(l.nextSibling),t=i.nextSibling,g=t.firstChild,[_,u]=b(g.nextSibling),a=_.nextSibling,x=a.nextSibling,[$,S]=b(x.nextSibling),y=t.nextSibling;return o(d,(()=>{const h=I(()=>!!e.opening);return()=>h()&&(()=>{const v=m(ee),N=v.firstChild,[C,R]=b(N.nextSibling),T=C.nextSibling,B=T.nextSibling,[P,E]=b(B.nextSibling);return P.nextSibling,o(v,()=>n.opening,C,R),o(v,()=>e.opening,P,E),v})()})(),i,s),o(t,()=>n.gameResult,_,u),o(t,r,$,S),o(y,c),d})()},ne=f('<h1 class="text-3xl font-black text-primary-100 mb-3"></h1>'),re=`
r n b q k b n r
p p p p p p p p
_ _ _ _ _ _ _ _
_ _ _ _ _ _ _ _
_ _ _ _ _ _ _ _
_ _ _ _ _ _ _ _
P P P P P P P P
R N B Q K B N R`;function M(e){let n=new Map;for(let[r,c]of e)n.has(r)||n.set(r,new Set),n.get(r).add(c);return n}const ce=()=>{let[e,n]=w(),[r,c]=w(!1),d=()=>e()?.board??re,l=k();U(()=>{K(!0).then(t=>{n({board:t.board,gameId:t.game_id,possible:M(t.possible),state:t.game_state,opening:t.opening})})});async function i(t,g,_){if(r()||_===void 0||!_.possible.get(t)?.has(g))return;c(!0);let u=await O(_.gameId,t,g);n({gameId:_.gameId,possible:M(u.possible),board:u.board,state:u.game_state,opening:u.opening}),c(!1)}let s=()=>e()?.state==="gameResultUndefined"&&!r();return p(j,{get children(){return p(H,{get children(){return[(()=>{const t=m(ne);return o(t,()=>l.title),t})(),p(te,{get opening(){return e()?.opening},get result(){return e()?.state},get playerTurn(){return I(()=>!!e())()&&!r()}}),p(Y,{get interactive(){return s()},get board(){return d()},get possible(){return e()?.possible??new Map},onMove:(t,g)=>i(t,g,e())})]}})}})};export{ce as C};
